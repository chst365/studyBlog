---
title: æ‹å¹³æ•°ç»„flat
date: 2022-09-02 13:38:28
permalink: /pages/ec8daf/
categories: 
  - å‰ç«¯
  - ç¼–ç¨‹é¢˜
tags: 
  - å‰ç«¯
  - ç¼–ç¨‹é¢˜
author: 
  name: chst365
  link: https://github.com/chst365
---
![](https://cdn.jsdelivr.net/gh/chst365/bolgImgs/imgs/topImgs/349.jpg)
## Array.prototype.flat()
```js
const animals = ["ğŸ·", ["ğŸ¶", "ğŸ‚"], ["ğŸ", ["ğŸ‘", ["ğŸ²"]], "ğŸ›"]];

// ä¸ä¼ å‚ï¼Œé»˜è®¤æ‹‰å¹³ä¸€å±‚
animals.flat();
// [ 'ğŸ·', 'ğŸ¶', 'ğŸ‚', 'ğŸ', [ 'ğŸ‘', [ 'ğŸ²' ] ], 'ğŸ›' ]

// ä¼ ä¸€ä¸ªæ•´æ•°å‚æ•°ï¼Œæ•´æ•°å³æ‹‰å¹³çš„å±‚æ•°
animals.flat(2);
// [ 'ğŸ·', 'ğŸ¶', 'ğŸ‚', 'ğŸ', 'ğŸ‘', [ 'ğŸ²' ], 'ğŸ›' ]

// Infinity ä½œä¸ºå‚æ•°ï¼Œæ— è®ºåµŒå¥—å¤šå°‘å±‚ï¼Œéƒ½è½¬ä¸ºä¸€ç»´æ•°ç»„
animals.flat(Infinity);
// ['ğŸ·', 'ğŸ¶', 'ğŸ‚', 'ğŸ', 'ğŸ‘', 'ğŸ²', 'ğŸ›']

// ä¼ å…¥ <= 0çš„æ•´æ•° è¿”å›åŸæ•°ç»„
animals.flat(0);
animals.flat(-10);
// ["ğŸ·", ["ğŸ¶", "ğŸ‚"], ["ğŸ", ["ğŸ‘", ["ğŸ²"]], "ğŸ›"]]

// å¦‚æœåŸæ•°ç»„æœ‰ç©ºä½ï¼Œflat()æ–¹æ³•ä¼šè·³è¿‡ç©ºä½ã€‚
["ğŸ·", "ğŸ¶", "ğŸ‚", "ğŸ", ,].flat();
// ["ğŸ·", "ğŸ¶", "ğŸ‚", "ğŸ"]
```
#### Array.prototype.flat() ç‰¹æ€§
- ç”¨äºå°†åµŒå¥—æ•°ç»„æ‹‰å¹³ï¼Œå˜æˆä¸€ç»´æ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¯¹åŸæ•°ç»„æ²¡å½±å“
- ä¸ä¼ å‚ï¼Œé»˜è®¤æ‹‰å¹³ä¸€å±‚ï¼›ä¼ å…¥ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‹‰å¹³çš„å±‚æ•°
- ä¼ å…¥ <= 0 çš„æ•´æ•°ï¼Œè¿”å›åŸæ•°ç»„
- Infinity å…³é”®å­—ä½œä¸ºå‚æ•°ï¼Œæ— è®ºåµŒå¥—å¤šå°‘å±‚ï¼Œéƒ½è½¬ä¸ºä¸€ç»´æ•°ç»„
- è‹¥åŸæ•°ç»„æœ‰ç©ºä½ï¼Œä¼šè·³è¿‡ç©ºä½

### å®ç°ä¸€ä¸ªæ•°ç»„æ‹å¹³flatå‡½æ•°

#### å®ç°æ€è·¯
- éå†æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ 
- åˆ¤æ–­å…ƒç´ æ˜¯å¦æ˜¯æ•°ç»„
- å°†æ•°ç»„çš„å…ƒç´ å±•å¼€ä¸€å±‚

```js
const arr = [1, 2, 3, 4, [1, 2, 3, [1, 2, 3, [1, 2, 3]]], 5, "string", { name: "å¼¹é“è›‹åŒå­¦" }];
// concat + é€’å½’
function flat(arr) {
  let arrResult = [];
  arr.forEach(item => {
    if (Array.isArray(item)) {
      arrResult = arrResult.concat(arguments.callee(item));   // é€’å½’
      // æˆ–è€…ç”¨æ‰©å±•è¿ç®—ç¬¦
      // arrResult.push(...arguments.callee(item));
    } else {
      arrResult.push(item);
    }
  });
  return arrResult;
}
flat(arr)
// [1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 1, 2, 3, 5, "string", { name: "å¼¹é“è›‹åŒå­¦" }];
```
### ç”¨ reduce å®ç° flat å‡½æ•°
```js
const arr = [1, 2, 3, 4, [1, 2, 3, [1, 2, 3, [1, 2, 3]]], 5, "string", { name: "å¼¹é“è›‹åŒå­¦" }]

const flat = arr => {
    return arr.reduce((pre, cur) => {
        return pre.concat(Array.isArray(cur) ? flat(cur) : cur);
    }, []);
};
```

### ç”¨æ ˆçš„æ€æƒ³å®ç° flat å‡½æ•°
```js
function flat(arr) {
    const result = [];
    const stack = [].concat(arr); // å°†æ•°ç»„å…ƒç´ æ‹·è´è‡³æ ˆï¼Œç›´æ¥èµ‹å€¼ä¼šæ”¹å˜åŸæ•°ç»„
    while (stack.length !== 0) {
        const val = stack.pop();
        Array.isArray(val) ? stack.push(...val) : result.unshift(val);
    }
    return result;
}
```

### é€šè¿‡ä¼ å…¥æ•´æ•°å‚æ•°æ§åˆ¶æ‹‰å¹³å±‚æ•°
```js
function flat(arr, num = 1) {
    return num > 0 ? arr.reduce((pre, cur) => pre.concat(Array.isArray(cur) ? flat(cur, num - 1) : cur), []) : arr.slice();
}
```
### ä½¿ç”¨ Generator å®ç° flat å‡½æ•°
```js
function* flat(arr, num = 1) {
    for (const item of arr) {
        if (Array.isArray(item) && num > 0) {
            yield* flat(item, num - 1);
        } else {
            yield item;
        }
    }
}
// è°ƒç”¨ Generator å‡½æ•°åï¼Œè¯¥å‡½æ•°å¹¶ä¸æ‰§è¡Œï¼Œè¿”å›çš„ä¹Ÿä¸æ˜¯å‡½æ•°è¿è¡Œç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡å‘å†…éƒ¨çŠ¶æ€çš„æŒ‡é’ˆå¯¹è±¡
// å³éå†å™¨å¯¹è±¡ï¼Œéœ€ç”¨ä¸€æ¬¡æ‰©å±•ç¬¦è¿ç®—å¾—åˆ°ç»“æœ
console.log([...flat(arr)]);
```
### å®ç°åœ¨åŸå‹é“¾ä¸Šé‡å†™flatå‡½æ•°
```js
Array.prototype.fakeFlat = function (num = 1) {
    if (!Number(num) || Number(num) < 0) return this;
    let arr = this.concat();
    while (num > 0) {
        if (arr.some(x => Array.isArray(x))) {
            arr = [].concat.apply([], arr);
            console.log(arr);
        } else {
            break;
        }
        num--;
    }
    return arr;
};
console.log(arr.fakeFlat(Infinity));
```

### è€ƒè™‘æ•°ç»„ç©ºä½æƒ…å†µ

ES5å¤§å¤šæ•°æ•°ç»„æ–¹æ³•å¯¹ç©ºä½çš„å¤„ç†éƒ½ä¼šé€‰æ‹©è·³è¿‡ç©ºä½ï¼š`forEach()`ã€`filter()`ã€`reduce()`ã€`every()`ã€`some()`
```js
const arr = [1, [3, 4], , ,];
// reduce + é€’å½’
Array.prototype.fakeFlat = function(num = 1) {
  if (!Number(num) || Number(num) < 0) {
    return this;
  }
  let arr = [].concat(this);
  return num > 0
    ? arr.reduce(
        (pre, cur) =>
          pre.concat(Array.isArray(cur) ? cur.fakeFlat(--num) : cur),
        []
      )
    : arr.slice();
};
arr.fakeFlat()
// [1, 3, 4]

// foEach + é€’å½’
Array.prototype.fakeFlat = function(num = 1) {
  if (!Number(num) || Number(num) < 0) {
    return this;
  }
  let arr = [];
  this.forEach(item => {
    if (Array.isArray(item)) {
      arr = arr.concat(item.fakeFlat(--num));
    } else {
      arr.push(item);
    }
  });
  return arr;
};
arr.fakeFlat()
// [1, 3, 4]
```

#### ES5 ä¸ ES6 å¯¹æ•°ç»„ç©ºä½çš„å¤„ç†
**ES5åœ¨å¤šæ•°æƒ…å†µä¸‹å›å¿½ç•¥ç©ºä½**
- `forEach()`ã€`filter()`ã€`reduce()`ã€`every()`å’Œ`some()` éƒ½ä¼šè·³è¿‡ç©ºä½
- `map()`ä¼šè·³è¿‡ç©ºä½ï¼Œä½†ä¼šä¿ç•™è¿™ä¸ªå€¼
- `join()`å’Œ`toString()`ä¼šå°†ç©ºä½è§†ä¸º`undefined`ï¼Œè€Œ`undefined`å’Œ`null`ä¼šè¢«å¤„ç†æˆç©ºå­—ç¬¦ä¸²

**ES6æ˜ç¡®å°†ç©ºä½è½¬ä¸ºundefined**
- `entries()`ã€`keys()`ã€`values()`ã€`find()`å’Œ`findIndex()`ä¼šå°†ç©ºä½å¤„ç†æˆ`undefined`
- `for...of`å¾ªç¯ä¼šéå†ç©ºä½
- `fill()`ä¼šå°†ç©ºä½è§†ä¸ºæ­£å¸¸çš„æ•°ç»„ä½ç½®
- `copyWithin()`ä¼šè¿ç©ºä½ä¸€èµ·æ‹·è´
- æ‰©å±•è¿ç®—ç¬¦ä¹Ÿä¼šå°†ç©ºä½è½¬ä¸º`undefined`
- `Array.from`æ–¹æ³•ä¼šå°†æ•°ç»„çš„ç©ºä½è½¬ä¸º`undefined`




