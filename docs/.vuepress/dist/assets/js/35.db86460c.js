(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{363:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/chst365/bolgImgs/imgs/topImgs/220.jpg",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"总结的要点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结的要点"}},[s._v("#")]),s._v(" 总结的要点")]),s._v(" "),t("ul",[t("li",[s._v("精简 DOM，合理布局")]),s._v(" "),t("li",[s._v("使用 transform 代替 left,top 减少使用引起页面重排的属性")]),s._v(" "),t("li",[s._v("开启硬件加速")]),s._v(" "),t("li",[s._v("尽量避免浏览器创建不必要的图形层")]),s._v(" "),t("li",[s._v("尽量减少 js 动画，如需要，使用对性能更友好的"),t("code",[s._v("requestAnimationFrame")])]),s._v(" "),t("li",[s._v("使用 chrome performance 工具调试动画性能")])]),s._v(" "),t("p",[s._v("我们知道网页动画的每一帧都是一次重新渲染，每秒低于 24 帧的动画，人眼会感受到停顿，30~60 帧/s 才比较流畅，大多数屏幕的刷新频率 60Hz,这就意味着每一帧的任务耗时不能高于 16ms")]),s._v(" "),t("p",[s._v("浏览器渲染每一帧的过程，如图:\n"),t("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/1621708-a41d34fd8b262bb6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1095/format/webp",alt:""}})]),s._v(" "),t("ol",[t("li",[s._v("js\n我们可以使用 js 来实现一些视觉变化的效果，也可以使用一些其他的常用方法：CSS Animations、Transitions 和 Web Animation API")]),s._v(" "),t("li",[s._v("样式计算\n此过程根据匹配选择器计算出哪些元素应用哪些 CSS3 规则，并将应用规则并计算每个元素的最终样式")]),s._v(" "),t("li",[s._v("布局\n浏览器开始计算元素占据的空间大小及在屏幕的位置。网页的布局模式意味着一个元素可能影响其他元素，因此对于浏览器来说，布局过程是经常发生的")]),s._v(" "),t("li",[s._v("绘制\n填充像素的过程。涉及绘出文本、颜色、图像、边框和阴影，基本上包括元素的每个可视部分。绘制一般是在多个表面（层）上完成的")]),s._v(" "),t("li",[s._v("合成\n由于页面的各部分可能被绘制到多层，由此他们需要按正确顺序绘制到屏幕上，以便正确渲染页面。对于与另一元素重叠的元素来说，这点特别重要，因为一个错误可能使一个元素错误出现在另一个元素的上层")])]),s._v(" "),t("p",[s._v("生成布局（flow）和绘制（paint）合称渲染（render）。重排必然导致重绘，重绘不一定需要重排。\n"),t("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/1621708-67a605f7213dd67f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/720/format/webp",alt:""}})]),s._v(" "),t("p",[s._v("优化页面渲染：")]),s._v(" "),t("ul",[t("li",[s._v("精简 DOM 元素，合理布局，样式表尽可能简单，重绘和重排就越快")]),s._v(" "),t("li",[s._v("多使用 div+css 布局，避免使用 table 布局（table 元素的重排和重绘成本要高于 div）")]),s._v(" "),t("li",[s._v("DOM 元素读写分离")]),s._v(" "),t("li",[s._v("让进行大量动画的元素脱离文档流，减少重排开销")]),s._v(" "),t("li",[s._v("通过改变元素的 class 或 csstext 一次性的更改样式")]),s._v(" "),t("li",[s._v("缓存 DOM 元素的位置信息，避免不必要的属性读取")]),s._v(" "),t("li",[s._v("尽量使用离线 DOM")]),s._v(" "),t("li",[s._v("使用 css3 transform 优化动画性能")])]),s._v(" "),t("h3",{attrs:{id:"css3-transform-的执行效率"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#css3-transform-的执行效率"}},[s._v("#")]),s._v(" css3 transform 的执行效率")]),s._v(" "),t("div",{staticClass:"language-css line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-css"}},[t("code",[t("span",{pre:!0,attrs:{class:"token selector"}},[s._v("\x3c!-- 对应图1-- > div")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("height")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 100px"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("transition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" height 1s linear"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token selector"}},[s._v("div:hover")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("height")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 200px"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token selector"}},[s._v("\x3c!-- 对应图2 -- > div")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("transform")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scale")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0.5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("transition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" transform 1s linear"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token selector"}},[s._v("div:hover")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("transform")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scale")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("一个从 height: 100px 到 height: 200px 的 动画按照下面的流程图来执行各种操作橙色方框的操作比较耗时，绿色方框的操作比较快速\n"),t("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/1621708-2f9474dd0744d413.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/455/format/webp",alt:""}}),s._v(" "),t("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/1621708-a013fcb7fed434ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/510/format/webp",alt:""}}),s._v("\n因为每一帧的变化浏览器都在进行布局、绘制、把新的位图交给 GPU 内存，但是在将位图加载到 GPU 内存中的操作是个相对耗时的操作。")]),s._v(" "),t("p",[s._v("GPU 在如下方面很快：")]),s._v(" "),t("ul",[t("li",[s._v("绘制位图到屏幕上")]),s._v(" "),t("li",[s._v("可不断的绘制相同的位图")]),s._v(" "),t("li",[s._v("将同一位图进行位移、旋转、缩放")])]),s._v(" "),t("h3",{attrs:{id:"层的引入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#层的引入"}},[s._v("#")]),s._v(" 层的引入")]),s._v(" "),t("p",[s._v("在 Chrome 中实际上有几种不同类型的层：")]),s._v(" "),t("ul",[t("li",[s._v("掌管 DOM 子树的渲染层（RenderLayer）")]),s._v(" "),t("li",[s._v("掌管渲染层子树的图形层（GraphicsLayer）")]),s._v(" "),t("li",[s._v("某些特殊的渲染层被认为是合成层（Compositing Layers），合成层拥有单独的 GraphicsLayer")])]),s._v(" "),t("p",[s._v("拥有单独 GraphicsLayer 的层，都会将位图存储在共享内存中，作为纹理上传到 GPU 中，最后由 GPU 将多个位图进行合成，然后 draw 到屏幕上")]),s._v(" "),t("p",[s._v("在哪些因素下会将渲染层提升为合成层：")]),s._v(" "),t("ul",[t("li",[s._v("进行 3D 或透视变换的 css 属性")]),s._v(" "),t("li",[s._v("使用硬件加速视频解码的"),t("code",[s._v("<video>")]),s._v("元素")]),s._v(" "),t("li",[s._v("具有 3D（WebGL）上下文或硬件加速的 2D 上下文的"),t("code",[s._v("<canvas>")]),s._v("元素")]),s._v(" "),t("li",[s._v("组合型插件（即 Flash）")]),s._v(" "),t("li",[s._v("具有有 CSS 透明度动画或使用动画式 Webkit 变换的元素")]),s._v(" "),t("li",[s._v("具有硬件加速的 css 滤镜的元素")]),s._v(" "),t("li",[s._v("子元素中存在具有组合层元素的元素（存在具有自己层的子元素的元素）")]),s._v(" "),t("li",[s._v("同级元素中有 Z 索引币其小的元素，且该 Z 索引比较小的元素具有组合层（在组合层之上进行渲染的元素）")])]),s._v(" "),t("p",[s._v("提升为合成层有什么好处")]),s._v(" "),t("ul",[t("li",[s._v("合成层的位图，会交由 GPU 合成，币 CPU 处理要快")]),s._v(" "),t("li",[s._v("当需要 repaint 时，只需要 repaint 本身，不会影响到其他的层")]),s._v(" "),t("li",[s._v("对于 transform 和 opacity 效果，不会触发 layout 和 paint")])]),s._v(" "),t("p",[s._v("提升合成层的最好方式是使用 CSS 的 will-change 属性，如 will-change 设置为 opacity/transform/top/left/bottom/right")]),s._v(" "),t("p",[s._v("对于还不支持 will-change 属性的浏览器，可以使用一个 3D transform 属性来强制提升为合成层："),t("code",[s._v("transform:translateZ(0)")])]),s._v(" "),t("p",[s._v("通常情况下开启硬件加速会提高动画的流畅性，但是过多的合成层也会造成性能瓶颈，会占用大量的内存空间")]),s._v(" "),t("h3",{attrs:{id:"网页动画的渲染"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#网页动画的渲染"}},[s._v("#")]),s._v(" 网页动画的渲染")]),s._v(" "),t("p",[s._v("在 js 中有一些方法可以调节重新渲染，大幅提高网页性能")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("window.requestAnimationFrame(fn)")]),s._v("可以将某些代码放到下一次重新渲染执行")]),s._v(" "),t("li",[t("code",[s._v("window.requestIdleCallback(fn)")]),s._v("可以调节重新渲染。它指定只有当一帧的末尾有空闲时间，才会执行回调函数。只有当前帧运行时间小于 16.66ms 时，函数 fn 才会执行，否则，就推迟奥下一帧，下一帧没时间，继续推迟下去\n"),t("ul",[t("li",[t("code",[s._v("window.requestIdleCallback(fn, 5000)")]),s._v("如果在指定的这段时间内，每一帧都没有空闲时间，那么函数 fn 将会强制执行")])])])]),s._v(" "),t("h3",{attrs:{id:"chrome-devtool-performance"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chrome-devtool-performance"}},[s._v("#")]),s._v(" Chrome Devtool Performance")]),s._v(" "),t("p",[s._v("怎么去分析页面运行时的性能表现，"),t("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F29879682",target:"_blank",rel:"noopener noreferrer"}},[s._v("Chrome Devtool Performance"),t("OutboundLink")],1),s._v("是一个很好的选择。")])])}),[],!1,null,null,null);t.default=e.exports}}]);