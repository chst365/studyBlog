(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{470:function(e,s,_){"use strict";_.r(s);var v=_(9),a=Object(v.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/chst365/bolgImgs/imgs/topImgs/371.jpg",alt:""}})]),e._v(" "),s("h1",{attrs:{id:"面试官-说说-node-文件查找的优先级以及-require-方法的文件查找策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#面试官-说说-node-文件查找的优先级以及-require-方法的文件查找策略"}},[e._v("#")]),e._v(" 面试官：说说 Node 文件查找的优先级以及 Require 方法的文件查找策略?")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://static.vue-js.com/15913530-c9ba-11eb-ab90-d9ae814b240d.png",alt:""}})]),e._v(" "),s("h2",{attrs:{id:"一、模块规范"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、模块规范"}},[e._v("#")]),e._v(" 一、模块规范")]),e._v(" "),s("p",[s("code",[e._v("NodeJS")]),e._v("对"),s("code",[e._v("CommonJS")]),e._v("进行了支持和实现，让我们在开发"),s("code",[e._v("node")]),e._v("的过程中可以方便的进行模块化开发：")]),e._v(" "),s("ul",[s("li",[e._v("在Node中每一个js文件都是一个单独的模块")]),e._v(" "),s("li",[e._v("模块中包括CommonJS规范的核心变量：exports、module.exports、require")]),e._v(" "),s("li",[e._v("通过上述变量进行模块化开发")])]),e._v(" "),s("p",[e._v("而模块化的核心是导出与导入，在"),s("code",[e._v("Node")]),e._v("中通过"),s("code",[e._v("exports")]),e._v("与"),s("code",[e._v("module.exports")]),e._v("负责对模块中的内容进行导出，通过"),s("code",[e._v("require")]),e._v("函数导入其他模块（自定义模块、系统模块、第三方库模块）中的内容")]),e._v(" "),s("h2",{attrs:{id:"二、查找策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、查找策略"}},[e._v("#")]),e._v(" 二、查找策略")]),e._v(" "),s("p",[s("code",[e._v("require")]),e._v("方法接收一下几种参数的传递：")]),e._v(" "),s("ul",[s("li",[e._v("原生模块：http、fs、path等")]),e._v(" "),s("li",[e._v("相对路径的文件模块：./mod或../mod")]),e._v(" "),s("li",[e._v("绝对路径的文件模块：/pathtomodule/mod")]),e._v(" "),s("li",[e._v("目录作为模块：./dirname")]),e._v(" "),s("li",[e._v("非原生模块的文件模块：mod")])]),e._v(" "),s("p",[s("code",[e._v("require")]),e._v("参数较为简单，但是内部的加载却是十分复杂的，其加载优先级也各自不同，如下图：")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://static.vue-js.com/33ae8ef0-c9ba-11eb-85f6-6fac77c0c9b3.png",alt:""}})]),e._v(" "),s("p",[e._v("从上图可以看见，文件模块存在缓存区，寻找模块路径的时候都会优先从缓存中加载已经存在的模块")]),e._v(" "),s("h3",{attrs:{id:"原生模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原生模块"}},[e._v("#")]),e._v(" 原生模块")]),e._v(" "),s("p",[e._v("而像原生模块这些，通过"),s("code",[e._v("require")]),e._v("方法在解析文件名之后，优先检查模块是否在原生模块列表中，如果在则从原生模块中加载")]),e._v(" "),s("h3",{attrs:{id:"绝对路径、相对路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#绝对路径、相对路径"}},[e._v("#")]),e._v(" 绝对路径、相对路径")]),e._v(" "),s("p",[e._v("如果"),s("code",[e._v("require")]),e._v("绝对路径的文件，则直接查找对应的路径，速度最快")]),e._v(" "),s("p",[e._v("相对路径的模块则相对于当前调用"),s("code",[e._v("require")]),e._v("的文件去查找")]),e._v(" "),s("p",[e._v("如果按确切的文件名没有找到模块，则 "),s("code",[e._v("NodeJs")]),e._v(" 会尝试带上 "),s("code",[e._v(".js")]),e._v("、"),s("code",[e._v(".json")]),e._v("或 "),s("code",[e._v(".node")]),e._v("拓展名再加载")]),e._v(" "),s("h3",{attrs:{id:"目录作为模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#目录作为模块"}},[e._v("#")]),e._v(" 目录作为模块")]),e._v(" "),s("p",[e._v("默认情况是根据根目录中"),s("code",[e._v("package.json")]),e._v("文件的"),s("code",[e._v("main")]),e._v("来指定目录模块，如：")]),e._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"name"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"some-library"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"main"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"main.js"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("如果这是在"),s("code",[e._v("./some-library node_modules")]),e._v("目录中，则 "),s("code",[e._v("require('./some-library')")]),e._v(" 会试图加载 "),s("code",[e._v("./some-library/main.js")])]),e._v(" "),s("p",[e._v("如果目录里没有 "),s("code",[e._v("package.json")]),e._v("文件，或者 "),s("code",[e._v("main")]),e._v("入口不存在或无法解析，则会试图加载目录下的 "),s("code",[e._v("index.js")]),e._v(" 或 "),s("code",[e._v("index.node")]),e._v(" 文件")]),e._v(" "),s("h3",{attrs:{id:"非原生模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#非原生模块"}},[e._v("#")]),e._v(" 非原生模块")]),e._v(" "),s("p",[e._v("在每个文件中都存在"),s("code",[e._v("module.paths")]),e._v("，表示模块的搜索路径，"),s("code",[e._v("require")]),e._v("就是根据其来寻找文件")]),e._v(" "),s("p",[e._v("在"),s("code",[e._v("window")]),e._v("下输出如下：")]),e._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'c:\\\\nodejs\\\\node_modules'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'c:\\\\node_modules'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("可以看出"),s("code",[e._v("module path")]),e._v("的生成规则为：从当前文件目录开始查找"),s("code",[e._v("node_modules")]),e._v("目录；然后依次进入父目录，查找父目录下的"),s("code",[e._v("node_modules")]),e._v("目录，依次迭代，直到根目录下的"),s("code",[e._v("node_modules")]),e._v("目录")]),e._v(" "),s("p",[e._v("当都找不到的时候，则会从系统"),s("code",[e._v("NODE_PATH")]),e._v("环境变量查找")]),e._v(" "),s("h4",{attrs:{id:"举个例子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#举个例子"}},[e._v("#")]),e._v(" 举个例子：")]),e._v(" "),s("p",[e._v("如果在"),s("code",[e._v("/home/ry/projects/foo.js")]),e._v("文件里调用了 "),s("code",[e._v("require('bar.js')")]),e._v("，则 Node.js 会按以下顺序查找：")]),e._v(" "),s("ul",[s("li",[e._v("/home/ry/projects/node_modules/bar.js")]),e._v(" "),s("li",[e._v("/home/ry/node_modules/bar.js")]),e._v(" "),s("li",[e._v("/home/node_modules/bar.js")]),e._v(" "),s("li",[e._v("/node_modules/bar.js")])]),e._v(" "),s("p",[e._v("这使得程序本地化它们的依赖，避免它们产生冲突")]),e._v(" "),s("h2",{attrs:{id:"三、总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、总结"}},[e._v("#")]),e._v(" 三、总结")]),e._v(" "),s("p",[e._v("通过上面模块的文件查找策略之后，总结下文件查找的优先级：")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("缓存的模块优先级最高")])]),e._v(" "),s("li",[s("p",[e._v("如果是内置模块，则直接返回，优先级仅次缓存的模块")])]),e._v(" "),s("li",[s("p",[e._v("如果是绝对路径 / 开头，则从根目录找")])]),e._v(" "),s("li",[s("p",[e._v("如果是相对路径 ./开头，则从当前require文件相对位置找")])]),e._v(" "),s("li",[s("p",[e._v("如果文件没有携带后缀，先从js、json、node按顺序查找")])]),e._v(" "),s("li",[s("p",[e._v("如果是目录，则根据 package.json的main属性值决定目录下入口文件，默认情况为 index.js")])]),e._v(" "),s("li",[s("p",[e._v("如果文件为第三方模块，则会引入 node_modules 文件，如果不在当前仓库文件中，则自动从上级递归查找，直到根目录")])])]),e._v(" "),s("h2",{attrs:{id:"参考文献"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[e._v("#")]),e._v(" 参考文献")]),e._v(" "),s("ul",[s("li",[e._v("http://nodejs.cn/api/modules.html#modules_file_modules")]),e._v(" "),s("li",[e._v("https://blog.csdn.net/qq_36801250/article/details/106352686")]),e._v(" "),s("li",[e._v("https://www.cnblogs.com/samve/p/10805908.html")])])])}),[],!1,null,null,null);s.default=a.exports}}]);