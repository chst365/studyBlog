<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Babel原理 | chst365&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <script src="/js/matomo.js"></script>
    <meta name="description" content="">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.05e4719f.css" as="style"><link rel="preload" href="/assets/js/app.cd205809.js" as="script"><link rel="preload" href="/assets/js/2.f4247a0b.js" as="script"><link rel="preload" href="/assets/js/44.221c0a08.js" as="script"><link rel="prefetch" href="/assets/js/10.1f8b721e.js"><link rel="prefetch" href="/assets/js/100.f363f0d3.js"><link rel="prefetch" href="/assets/js/101.85a764ea.js"><link rel="prefetch" href="/assets/js/102.a23dedbc.js"><link rel="prefetch" href="/assets/js/103.5d871ff3.js"><link rel="prefetch" href="/assets/js/104.c0824122.js"><link rel="prefetch" href="/assets/js/105.b7771559.js"><link rel="prefetch" href="/assets/js/106.daaa6968.js"><link rel="prefetch" href="/assets/js/11.ea5e4de6.js"><link rel="prefetch" href="/assets/js/12.553129ba.js"><link rel="prefetch" href="/assets/js/13.7865d264.js"><link rel="prefetch" href="/assets/js/14.41401a3e.js"><link rel="prefetch" href="/assets/js/15.c2afe54f.js"><link rel="prefetch" href="/assets/js/16.a43eb27a.js"><link rel="prefetch" href="/assets/js/17.3f70e649.js"><link rel="prefetch" href="/assets/js/18.077179f4.js"><link rel="prefetch" href="/assets/js/19.cc27c66c.js"><link rel="prefetch" href="/assets/js/20.96de9769.js"><link rel="prefetch" href="/assets/js/21.9a2f2b62.js"><link rel="prefetch" href="/assets/js/22.3e64c865.js"><link rel="prefetch" href="/assets/js/23.77873e3e.js"><link rel="prefetch" href="/assets/js/24.5c089697.js"><link rel="prefetch" href="/assets/js/25.30d890b0.js"><link rel="prefetch" href="/assets/js/26.856dcd0f.js"><link rel="prefetch" href="/assets/js/27.92108683.js"><link rel="prefetch" href="/assets/js/28.22f26ab9.js"><link rel="prefetch" href="/assets/js/29.9a1d1fc8.js"><link rel="prefetch" href="/assets/js/3.ffdab1d7.js"><link rel="prefetch" href="/assets/js/30.96d98bb0.js"><link rel="prefetch" href="/assets/js/31.f14b1cd8.js"><link rel="prefetch" href="/assets/js/32.1e6cb6bf.js"><link rel="prefetch" href="/assets/js/33.fca22aba.js"><link rel="prefetch" href="/assets/js/34.aa3aff20.js"><link rel="prefetch" href="/assets/js/35.850d073c.js"><link rel="prefetch" href="/assets/js/36.a61cb73e.js"><link rel="prefetch" href="/assets/js/37.094eb773.js"><link rel="prefetch" href="/assets/js/38.b83ab7e9.js"><link rel="prefetch" href="/assets/js/39.63f58f95.js"><link rel="prefetch" href="/assets/js/4.d17461ef.js"><link rel="prefetch" href="/assets/js/40.d79c2f20.js"><link rel="prefetch" href="/assets/js/41.93c8469a.js"><link rel="prefetch" href="/assets/js/42.edc76019.js"><link rel="prefetch" href="/assets/js/43.075a2e7e.js"><link rel="prefetch" href="/assets/js/45.e09410d8.js"><link rel="prefetch" href="/assets/js/46.c82dd355.js"><link rel="prefetch" href="/assets/js/47.801dd2e4.js"><link rel="prefetch" href="/assets/js/48.47497bb0.js"><link rel="prefetch" href="/assets/js/49.d12b5c28.js"><link rel="prefetch" href="/assets/js/5.45fbd149.js"><link rel="prefetch" href="/assets/js/50.efc68c2c.js"><link rel="prefetch" href="/assets/js/51.c9c5da83.js"><link rel="prefetch" href="/assets/js/52.a8526fbd.js"><link rel="prefetch" href="/assets/js/53.7c68ae2b.js"><link rel="prefetch" href="/assets/js/54.769310a8.js"><link rel="prefetch" href="/assets/js/55.7e05df38.js"><link rel="prefetch" href="/assets/js/56.fe90c2a1.js"><link rel="prefetch" href="/assets/js/57.072cadda.js"><link rel="prefetch" href="/assets/js/58.5174caa2.js"><link rel="prefetch" href="/assets/js/59.df635a0c.js"><link rel="prefetch" href="/assets/js/6.5267bf34.js"><link rel="prefetch" href="/assets/js/60.20818bd0.js"><link rel="prefetch" href="/assets/js/61.565ac782.js"><link rel="prefetch" href="/assets/js/62.8e7a4b12.js"><link rel="prefetch" href="/assets/js/63.47b49893.js"><link rel="prefetch" href="/assets/js/64.8b8132ff.js"><link rel="prefetch" href="/assets/js/65.176f974e.js"><link rel="prefetch" href="/assets/js/66.15777306.js"><link rel="prefetch" href="/assets/js/67.98f0435e.js"><link rel="prefetch" href="/assets/js/68.a3f1de9e.js"><link rel="prefetch" href="/assets/js/69.01f505a6.js"><link rel="prefetch" href="/assets/js/7.73beeb4e.js"><link rel="prefetch" href="/assets/js/70.35b0e2ef.js"><link rel="prefetch" href="/assets/js/71.42320c92.js"><link rel="prefetch" href="/assets/js/72.0982540e.js"><link rel="prefetch" href="/assets/js/73.99b80034.js"><link rel="prefetch" href="/assets/js/74.ebe2bce2.js"><link rel="prefetch" href="/assets/js/75.faf0a669.js"><link rel="prefetch" href="/assets/js/76.61e5c54f.js"><link rel="prefetch" href="/assets/js/77.454124a8.js"><link rel="prefetch" href="/assets/js/78.397cd723.js"><link rel="prefetch" href="/assets/js/79.f7930c39.js"><link rel="prefetch" href="/assets/js/8.2b782333.js"><link rel="prefetch" href="/assets/js/80.5c57670d.js"><link rel="prefetch" href="/assets/js/81.1f401c91.js"><link rel="prefetch" href="/assets/js/82.49cbe843.js"><link rel="prefetch" href="/assets/js/83.5681afd7.js"><link rel="prefetch" href="/assets/js/84.c78ab70e.js"><link rel="prefetch" href="/assets/js/85.11ef1e4f.js"><link rel="prefetch" href="/assets/js/86.a5656f20.js"><link rel="prefetch" href="/assets/js/87.45e4eb5b.js"><link rel="prefetch" href="/assets/js/88.cf00f307.js"><link rel="prefetch" href="/assets/js/89.fb22ebaf.js"><link rel="prefetch" href="/assets/js/9.ba401c21.js"><link rel="prefetch" href="/assets/js/90.7adb6aee.js"><link rel="prefetch" href="/assets/js/91.fa9f285f.js"><link rel="prefetch" href="/assets/js/92.588d08cb.js"><link rel="prefetch" href="/assets/js/93.dbbb292a.js"><link rel="prefetch" href="/assets/js/94.5394d9a6.js"><link rel="prefetch" href="/assets/js/95.d092be46.js"><link rel="prefetch" href="/assets/js/96.7ded334b.js"><link rel="prefetch" href="/assets/js/97.a410395a.js"><link rel="prefetch" href="/assets/js/98.a6861ab9.js"><link rel="prefetch" href="/assets/js/99.1bb26977.js">
    <link rel="stylesheet" href="/assets/css/0.styles.05e4719f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="chst365's blog" class="logo"> <span class="site-name can-hide">chst365's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发必备" class="dropdown-title"><a href="/basic/" class="link-title">开发必备</a> <span class="title" style="display:none;">开发必备</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/7a6999/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/857e93/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/pages/d8e2cc/" class="nav-link">操作系统</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/270f88/" class="nav-link">浏览器</a></li><li class="dropdown-item"><!----> <a href="/pages/a1323f/" class="nav-link">webpack</a></li><li class="dropdown-item"><!----> <a href="/pages/d1b7c1/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/pages/b3d0bc/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/pages/ba2200/" class="nav-link">性能</a></li><li class="dropdown-item"><!----> <a href="/pages/cadd60/" class="nav-link">工程化</a></li><li class="dropdown-item"><!----> <a href="/pages/483d46/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/pages/35ccf0/" class="nav-link">编程题</a></li><li class="dropdown-item"><!----> <a href="/pages/d382d4/" class="nav-link">React技术揭秘</a></li><li class="dropdown-item"><!----> <a href="/pages/e1c67e/" class="nav-link">算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/basic/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/25e852/" class="nav-link">Node</a></li></ul></div></div><div class="nav-item"><a href="/notes/" class="nav-link">杂记</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.png"> <div class="blogger-info"><h3>chst365</h3> <span>DIV工程师</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发必备" class="dropdown-title"><a href="/basic/" class="link-title">开发必备</a> <span class="title" style="display:none;">开发必备</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/7a6999/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/857e93/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/pages/d8e2cc/" class="nav-link">操作系统</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/270f88/" class="nav-link">浏览器</a></li><li class="dropdown-item"><!----> <a href="/pages/a1323f/" class="nav-link">webpack</a></li><li class="dropdown-item"><!----> <a href="/pages/d1b7c1/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/pages/b3d0bc/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/pages/ba2200/" class="nav-link">性能</a></li><li class="dropdown-item"><!----> <a href="/pages/cadd60/" class="nav-link">工程化</a></li><li class="dropdown-item"><!----> <a href="/pages/483d46/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/pages/35ccf0/" class="nav-link">编程题</a></li><li class="dropdown-item"><!----> <a href="/pages/d382d4/" class="nav-link">React技术揭秘</a></li><li class="dropdown-item"><!----> <a href="/pages/e1c67e/" class="nav-link">算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/basic/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/25e852/" class="nav-link">Node</a></li></ul></div></div><div class="nav-item"><a href="/notes/" class="nav-link">杂记</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>工程化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/cadd60/" class="sidebar-link">webpack-loader机制</a></li><li><a href="/pages/88c38e/" class="sidebar-link">webpack-插件机制</a></li><li><a href="/pages/9e9290/" class="sidebar-link">webpack工作流程</a></li><li><a href="/pages/ba5c4f/" aria-current="page" class="active sidebar-link">Babel原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/ba5c4f/#什么是-ast" class="sidebar-link">什么是 AST</a></li><li class="sidebar-sub-header level2"><a href="/pages/ba5c4f/#词法分析和语法分析" class="sidebar-link">词法分析和语法分析</a></li><li class="sidebar-sub-header level2"><a href="/pages/ba5c4f/#ast-能做什么" class="sidebar-link">AST 能做什么</a></li><li class="sidebar-sub-header level2"><a href="/pages/ba5c4f/#ast-解析流程" class="sidebar-link">AST 解析流程</a></li><li class="sidebar-sub-header level2"><a href="/pages/ba5c4f/#babel-工作原理" class="sidebar-link">Babel 工作原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/ba5c4f/#babel-插件的使用" class="sidebar-link">babel 插件的使用</a></li><li class="sidebar-sub-header level3"><a href="/pages/ba5c4f/#编写自己的插件" class="sidebar-link">编写自己的插件</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/ba5c4f/#按需引入" class="sidebar-link">按需引入</a></li><li class="sidebar-sub-header level2"><a href="/pages/ba5c4f/#babylon" class="sidebar-link">babyLon</a></li><li class="sidebar-sub-header level2"><a href="/pages/ba5c4f/#具体语法树" class="sidebar-link">具体语法树</a></li></ul></li><li><a href="/pages/bd96c8/" class="sidebar-link">uglify-js代码是如何被压缩的</a></li><li><a href="/pages/369571/" class="sidebar-link">Tree-Shaking性能优化</a></li><li><a href="/pages/2477bb/" class="sidebar-link">前端模块化机制</a></li><li><a href="/pages/46b314/" class="sidebar-link">前端微服务</a></li><li><a href="/pages/46d1bd/" class="sidebar-link">Vite为什么快？快在哪？</a></li><li><a href="/pages/87d40c/" class="sidebar-link">npm script了解多少？</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React技术揭秘</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E5%89%8D%E7%AB%AF" title="分类" data-v-06225672>前端</a></li><li data-v-06225672><a href="/categories/?category=%E5%B7%A5%E7%A8%8B%E5%8C%96" title="分类" data-v-06225672>工程化</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/chst365" target="_blank" title="作者" class="beLink" data-v-06225672>chst365</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2021-04-19</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Babel原理<!----></h1>  <div class="theme-vdoing-content content__default"><p><img src="https://cdn.jsdelivr.net/gh/chst365/bolgImgs/imgs/topImgs/68.jpg" alt=""></p> <h2 id="什么是-ast"><a href="#什么是-ast" class="header-anchor">#</a> 什么是 AST</h2> <p>抽象语法树（<code>Abstract Syntax Tree</code>），简称<code>AST</code>,是源代码的抽象语法结构的树状表现形式。
<code>webpack</code>,<code>eslint</code> 等很多工具的核心都是通过抽象语法树来实现对代码的检查、分析等操作。
<img src="https://oscimg.oschina.net/oscnet/d60e4800-53b4-466b-8cac-a78d3575d237.jpg" alt="">
上图中对应的：</p> <ul><li><code>var</code>是一个关键字</li> <li><code>AST</code>是一个定义者</li> <li><code>=</code>是 Equal 等号的叫法有很多形式</li> <li><code>is tree</code>是一个字符串</li> <li><code>;</code>是 Semicoion</li></ul> <p>首先一段代码转换成的抽象语法树是一个对象，该对象会有一个顶级的 type 属性<code>Program</code>;
第二个属性是<code>body</code>一个数组。<code>body</code>数组中存放的每一项都是一个对象，里面包含了所有的对于该语句的描述信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>type:         描述该语句的类型  --&gt; 变量声明的语句
kind:         变量声明的关键字  --&gt; var
declaration:  声明内容的数组，里面每一项也是一个对象
            type: 描述该语句的类型
            id:   描述变量名称的对象
                type: 定义
                name: 变量的名字
            init: 初始化变量值的对象
                type:   类型
                value:  值 &quot;is tree&quot; 不带引号
                row:    &quot;\&quot;is tree&quot;\&quot; 带引号
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="词法分析和语法分析"><a href="#词法分析和语法分析" class="header-anchor">#</a> 词法分析和语法分析</h2> <p>js 是解释性语音，一般通过 词法分析 -&gt; 语法分析 -&gt; 语法树，就可开始解释执行了</p> <p>词法分析：也叫扫描，是将字符流转换为记号流（tokens）,它会读取我们的代码然后按照一定的规则合成一个个的标识
如<code>var a = 2</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>;[
  { type: 'Keyword', value: 'var' },
  { type: 'Identifier', value: 'a' },
  { type: 'Punctuator', value: '=' },
  { type: 'Numeric', value: '2' },
]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>当词法分析源代码的时候，会一个一个字符读取代码，称之为扫描-<code>scans</code>，当遇到空格、操作符或者特殊符号的时候，它会认为一个话已经完成了。</p> <p>语法分析：也称解析器，将词法分析出来的数组转换成树的形式，同时验证语法，语法若有错，抛出语法错误</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  ...
  &quot;type&quot;: &quot;VariableDeclarator&quot;,
  &quot;id&quot;: {
    &quot;type&quot;: &quot;Identifier&quot;,
    &quot;name&quot;: &quot;a&quot;
  },
  ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>语法分析成 AST，我们可在这里在线看到效果<a href="http://esprima.org" target="_blank" rel="noopener noreferrer">http://esprima.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="ast-能做什么"><a href="#ast-能做什么" class="header-anchor">#</a> AST 能做什么</h2> <ul><li>语法检查、代码风格检查、格式化代码、语法高亮、错误提示、自动补全等</li> <li>代码混淆压缩</li> <li>优化变更带，改变代码结构等</li></ul> <h2 id="ast-解析流程"><a href="#ast-解析流程" class="header-anchor">#</a> AST 解析流程</h2> <ul><li>esprima: code =&gt; ast 代码转 ast</li> <li>estraverse: traverse ast 转换树</li> <li>escodegen: ast =&gt; code</li></ul> <p>再推荐一个常用的 AST 在线转换网站:<a href="https://astexplorer.net/" target="_blank" rel="noopener noreferrer">https://astexplorer.net/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>比如一段代码<code>function getUser() {}</code>,把函数名字改为<code>hello</code>，看代码流程</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> esprima <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;esprima&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> estraverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;estraverse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">function getUser() {}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// 生成 AST</span>
<span class="token keyword">const</span> ast <span class="token operator">=</span> esprima<span class="token punctuation">.</span><span class="token function">parseScript</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 转换 AST，只会遍历 type 属性</span>
<span class="token comment">// traverse 方法中有进入和离开两个钩子函数</span>
estraverse<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;enter -&gt; node.type&quot;</span><span class="token punctuation">,</span> node<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">leave</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;leave -&gt; node.type&quot;</span><span class="token punctuation">,</span> node<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>输出结果如下：</p> <p><img src="https://oscimg.oschina.net/oscnet/f6ecc074-bf06-4d8a-b25b-836cdc32e2c6.jpg" alt=""></p> <p>由此可得到 AST 遍历的过程是深度优先，遍历过程如下:</p> <p><img src="https://oscimg.oschina.net/oscnet/c7408a95-6cfb-43c0-9f48-e49634e254df.jpg" alt=""></p> <p>修改函数名字
此时我们发现函数的名字在 <code>type</code> 为 <code>Identifier</code> 的时候就是该函数的名字，我们就可以直接修改它便可实现一个更改函数名字的 AST 工具</p> <p><img src="https://oscimg.oschina.net/oscnet/948eebb7-a184-4ba4-a82b-d500587d39a9.jpg" alt=""></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 转换树</span>
estraverse<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// 进入离开修改都是可以的</span>
  <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;enter -&gt; node.type&quot;</span><span class="token punctuation">,</span> node<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">leave</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;leave -&gt; node.type&quot;</span><span class="token punctuation">,</span> node<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 生成新的代码</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> escodegen<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// function hello() {}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="babel-工作原理"><a href="#babel-工作原理" class="header-anchor">#</a> Babel 工作原理</h2> <p>提到 AST 我们会想到 babel，自 ES6 大规模使用以来，babel 就出现了，它主要解决了一些浏览器不兼容 ES6 新特性的问题，就是把 ES6 代码转换为 ES5 代码，兼容所有浏览器，babel 转换代码其实就是用了 AST。</p> <p>那我们在 babel 中使用 AST，看看 babel 是如何编译的？</p> <p>需要用到两个工具包<code>@babel/core</code>、<code>@babel/preset-env</code>
当我们配置 babel 的时候，不管在<code>.babelrc</code>或<code>babel.config.js</code>文件里面配置的都有<code>presets</code>和 <code>plugins</code>两个配置项</p> <h4 id="插件和预设的区别"><a href="#插件和预设的区别" class="header-anchor">#</a> 插件和预设的区别</h4> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// .babelrc</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>当我们配置了<code>presets</code>中有<code>@babel/preset-env</code>,那么<code>@babel/core</code>就会去找<code>preset-env</code>预设的插件包，它是一套。
babel 核心包并不会去转换代码，核心包只提供一些核心 API,真正的代码转换工作由插件或预设来完成，比如转换箭头函数，会用到<code>@babel/plugin-transform-arrow-functions</code>这个 plugin，当需要转换的要求增加时，我们不能去一一配置相应的 plugin，这时就可以用到预设了，也就是 presets。presets 是 plugins 的集合，一个 presets 内部包含了很多 plugin。</p> <h3 id="babel-插件的使用"><a href="#babel-插件的使用" class="header-anchor">#</a> babel 插件的使用</h3> <p>现在我们有一个箭头函数，要把它转成普通函数，我们可以直接这么写</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/core&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">const fn = (a, b) =&gt; a + b</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// babel 有 transform 方法会帮我们自动遍历，使用相应的预设或者插件转换相应的代码</span>
<span class="token keyword">const</span> r <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 打印结果如下</span>
<span class="token comment">// &quot;use strict&quot;;</span>
<span class="token comment">// var fn = function fn() { return a + b; };</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>我们可以看到代码被转为普通函数，但我们只要箭头函数转为普通函数的功能，不需要这么大一套包，其实我们可以在<code>node_modules</code>下面找到<code>plugin-transform-arrow-functions</code>的插件，此插件专门处理箭头函数的，可以这么写</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> r <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-transform-arrow-functions&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 打印结果如下</span>
<span class="token comment">// const fn = function () { return a + b; };</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>从结果可看出只转换了箭头函数。</p> <h3 id="编写自己的插件"><a href="#编写自己的插件" class="header-anchor">#</a> 编写自己的插件</h3> <p>实战：把<code>const fn = (a, b) =&gt; a + b</code>转换为<code>const fn = function () { return a + b }</code></p> <ul><li><p>分析 AST 结构</p> <p>首先我们在在线分析 AST 的网站分析<code>const fn = (a, b) =&gt; a + b</code>和<code>const fn = function () { return a + b }</code>两者语法树的区别
<img src="https://oscimg.oschina.net/oscnet/2730d973-5fbc-4ac2-9169-4922b3c6e4d5.jpg" alt=""></p> <p>分析可得：</p> <ul><li>变成普通函数后箭头函数<code>ArrowFunctionExpression</code>变成函数表达式<code>FunctionExpression</code></li> <li>所以我们要把<code>箭头函数表达式(ArrowFunctionExpression)</code>转换为<code>函数表达式(FunctionExpression)</code></li> <li>要把 <code>二进制表达式(BinaryExpression)</code>放到一个<code>代码块中(BlockStatement)</code></li> <li>其实我们要做的就是把一棵树变成另一棵树，即拼成另一棵树的结构，然后生成新的代码，就可以完成代码的转换</li></ul></li> <li><p>访问者模式</p> <p>在 babel 中，我们开发 plugins 的时候要用到访问者模式，就是在访问到某一个路径的时候进行匹配，然后对这个节点进行修改，如当我们访问到<code>ArrowFunctionExpression</code>的时候，对<code>ArrowFunctionExpression</code>进行修改，变成普通函数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/core&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">const fn = (a, b) =&gt; a + b</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// 转换后 const fn = function(a, b) { return a + b }</span>
<span class="token keyword">const</span> arrowFnPlugin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 访问者模式</span>
  <span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当访问到某个路径的时候进行匹配</span>
    <span class="token function">ArrowFunctionExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 拿到节点</span>
      <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ArrowFunctionExpression -&gt; node&quot;</span><span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> r <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>arrowFnPlugin<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li> <li><p>修改 AST 结构</p> <p>此时我们拿到节点，其实就是<code>ArrowFunctionExpression</code>的 AST，此时，我们要把<code>ArrowFunctionExpression</code>的结构替换成<code>FunctionExpression</code>的结构，但需要我们组装类似的结构，直接写很麻烦，但 babel 为我们提供了个工具<code>@babel/types</code></p> <ul><li><p><code>@babel/types</code>的作用</p> <ul><li>判断这个节点是不是这个节点(ArrowFunctionExpression 下面的 path.node 是不是一个 ArrowFunctionExpression)</li> <li>生成对应的表达式</li></ul> <p><code>t.functionExpression(id, params, body, generator, async)</code></p> <ul><li>id: Identifier (default: null) id 可传递 null</li> <li>params: Array<LVal> (required) 函数参数，可以把之前的参数拿过来</LVal></li> <li>body: BlockStatement (required) 函数体，接受一个 BlockStatement 我们需要生成一个</li> <li>generator: boolean (default: false) 是否为 generator 函数，当然不是了</li> <li>async: boolean (default: false) 是否为 async 函数，肯定不是了</li></ul> <p><code>t.blockStatement(body, directives)</code></p> <ul><li>看文档说明，blockStatement 接受一个 body，那我们把之前的 body 拿过来就可以直接用，不过这里 body 接受一个数组</li></ul></li></ul> <p>现在我们开始改写 AST 了</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/core&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/types&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">const fn = (a, b) =&gt; a + b</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// const fn = function(a, b) { return a + b }</span>
<span class="token keyword">const</span> arrowFnPlugin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 访问者模式</span>
  <span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当访问到某个路径的时候进行匹配</span>
    <span class="token function">ArrowFunctionExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 拿到节点然后替换节点</span>
      <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ArrowFunctionExpression -&gt; node&quot;</span><span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 拿到函数的参数</span>
      <span class="token keyword">const</span> params <span class="token operator">=</span> node<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
      <span class="token keyword">const</span> body <span class="token operator">=</span> node<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
      <span class="token keyword">const</span> functionExpression <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">functionExpression</span><span class="token punctuation">(</span>
        <span class="token keyword">null</span><span class="token punctuation">,</span>
        params<span class="token punctuation">,</span>
        t<span class="token punctuation">.</span><span class="token function">blockStatement</span><span class="token punctuation">(</span><span class="token punctuation">[</span>body<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 替换原来的函数</span>
      path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>functionExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> r <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>arrowFnPlugin<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// const fn = function (a, b) { return a + b; };</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li> <li><p>特殊情况</p> <p>我们知道在剪头函数中是可以省略 return 关键字，我们上面是处理了省略关键字的写法，但是如果用户写了 return 关键字后，我们写的这个插件就有问题了，所以我们可以在优化一下</p> <p><code>const fn = (a, b) =&gt; { retrun a + b }</code> -&gt; <code>const fn = function(a, b) { return a + b }</code>
观察代码我们发现，我们就不需要把 body 转换成 blockStatement 了，直接放过去就可以了，那么我们就可以这么写</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/core&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/types&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">const fn = (a, b) =&gt; a + b</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// const fn = function(a, b) { return a + b }</span>
<span class="token keyword">const</span> arrowFnPlugin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 访问者模式</span>
  <span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当访问到某个路径的时候进行匹配</span>
    <span class="token function">ArrowFunctionExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 拿到节点然后替换节点</span>
      <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ArrowFunctionExpression -&gt; node&quot;</span><span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> params <span class="token operator">=</span> node<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
      <span class="token keyword">let</span> body <span class="token operator">=</span> node<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
      <span class="token comment">// 判断是不是 blockStatement，不是的话让他变成 blockStatement</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>t<span class="token punctuation">.</span><span class="token function">isBlockStatement</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        body <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">blockStatement</span><span class="token punctuation">(</span><span class="token punctuation">[</span>body<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> functionExpression <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">functionExpression</span><span class="token punctuation">(</span>
        <span class="token keyword">null</span><span class="token punctuation">,</span>
        params<span class="token punctuation">,</span>
        t<span class="token punctuation">.</span><span class="token function">blockStatement</span><span class="token punctuation">(</span><span class="token punctuation">[</span>body<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 替换原来的函数</span>
      path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>functionExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> r <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>arrowFnPlugin<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// const fn = function (a, b) { return a + b; };</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div></li></ul> <h2 id="按需引入"><a href="#按需引入" class="header-anchor">#</a> 按需引入</h2> <p>在开发中，我们引入 UI 框架，如 vue 中用到<code>element-ui</code>、<code>vant</code>或 <code>react</code>中的<code>antd</code>都支持全局引入和按需引入，默认是全局引入，如果需要按需引入就安装一个<code>babel-plugin-import</code>的插件，将全局的写法变成按需引入的写法。
就拿我最近开发移动端用的 vant 为例， <code>import { Button } from 'vant'</code> 这种写法经过这个插件之后会变成 <code>import Button from 'vant/lib/Button'</code> 这种写法，引用整个 vant 变成了我只用了 vant 下面的某一个文件，打包后的文件会比全部引入的文件大小要小很多</p> <ul><li><p>分析语法树</p> <p><code>import { Button, Icon } from 'vant'</code> 写法转换为<code>import Button from 'vant/lib/Button';</code>、<code>import Icon from 'vant/lib/Icon'</code></p> <p>看下语法树的区别</p> <p><img src="https://oscimg.oschina.net/oscnet/822c18e6-1d5d-406f-ab28-b4dad891071f.jpg" alt=""></p> <p>由图分析得：</p> <ul><li>我们发现解构方式引入的模块只有 import 声明，第二张图是两个 import 声明</li> <li>解构方式引入的详细说明里面( <code>specifiers</code>)是两个 <code>ImportSpecifier</code>，第二张图里面是分开的，而且都是 <code>ImportDefaultSpecifier</code></li> <li>他们引入的 source 也不一样</li> <li>那我们要做的其实就是要把单个的 <code>ImportDeclaration</code> 变成多个 <code>ImportDeclaration</code>, 然后把单个 <code>import</code> 解构引入的 <code>specifiers</code> 部分 <code>ImportSpecifier</code> 转换成多个 <code>ImportDefaultSpecifier</code> 并修改对应的 <code>source</code> 即可</li></ul></li> <li><p>分析类型
这里我们需要用到的几个类型，也需在 types 官网上找对应的解释</p> <ul><li>首先我们要生成多个 <code>importDeclaration</code>类型<div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * @param {Array&lt;ImportSpecifier | ImportDefaultSpecifier | ImportNamespaceSpecifier&gt;} specifiers  (required)
 * @param {StringLiteral} source (required)
 */</span>
t<span class="token punctuation">.</span><span class="token function">importDeclaration</span><span class="token punctuation">(</span>specifiers<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li>在<code>importDeclaration</code>中需要生成<code>ImportDefaultSpecifier</code><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * @param {Identifier} local  (required)
 */</span>
t<span class="token punctuation">.</span><span class="token function">importDefaultSpecifier</span><span class="token punctuation">(</span>local<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li>在<code>importDeclaration</code>中还需生成一个<code>StringLiteral</code><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * @param {string} value  (required)
 */</span>
t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul></li> <li><p>上代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/core&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/types&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import { Button, Icon } from 'vant'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// import Button from 'vant/lib/Button'</span>
<span class="token comment">// import Icon from 'vant/lib/Icon'</span>
<span class="token keyword">function</span> <span class="token function">importPlugin</span><span class="token punctuation">(</span><span class="token parameter">opt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> libraryDir <span class="token punctuation">}</span> <span class="token operator">=</span> opt<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">ImportDeclaration</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
        <span class="token comment">// console.log(&quot;ImportDeclaration -&gt; node&quot;, node)</span>
        <span class="token comment">// 得到节点的详细说明，然后转换成多个的 import 声明</span>
        <span class="token keyword">const</span> specifiers <span class="token operator">=</span> node<span class="token punctuation">.</span>specifiers<span class="token punctuation">;</span>
        <span class="token comment">// 要处理这个我们做一些判断，首先判断不是默认导出我们才处理，要考虑 import vant, { Button, Icon } from 'vant' 写法</span>
        <span class="token comment">// 还要考虑 specifiers 的长度，如果长度不是 1 并且不是默认导出我们才需要转换</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token operator">!</span><span class="token punctuation">(</span>
            specifiers<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span>
            t<span class="token punctuation">.</span><span class="token function">isImportDefaultSpecifier</span><span class="token punctuation">(</span>specifiers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> result <span class="token operator">=</span> specifiers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">specifier</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> local <span class="token operator">=</span> specifier<span class="token punctuation">.</span>local<span class="token punctuation">;</span>
            <span class="token keyword">const</span> source <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>libraryDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>specifier<span class="token punctuation">.</span>local<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// console.log(&quot;ImportDeclaration -&gt; specifier&quot;, specifier)</span>
            <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">importDeclaration</span><span class="token punctuation">(</span>
              <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">importDefaultSpecifier</span><span class="token punctuation">(</span>local<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              source
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ImportDeclaration -&gt; result&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 因为这次要替换的 AST 不是一个，而是多个的，所以需要 `path.replaceWithMultiple(result)` 来替换，但是一执行发现死循环了</span>
          path<span class="token punctuation">.</span><span class="token function">replaceWithMultiple</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> r <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">importPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">libraryDir</span><span class="token operator">:</span> <span class="token string">&quot;lib&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>结果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ImportDeclaration -&gt; result [ { type: 'ImportDeclaration',
    specifiers: [ [Object] ],
    source: { type: 'StringLiteral', value: 'vant/lib/Button' } },
{ type: 'ImportDeclaration',
    specifiers: [ [Object] ],
    source: { type: 'StringLiteral', value: 'vant/lib/Icon' } } ]
import Button from &quot;vant/lib/Button&quot;;
import Icon from &quot;vant/lib/Icon&quot;;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>特殊情况
如果用户不全部按需加载了，按需加载只是一种选择，即<code>import vant, { Button, Icon } from 'vant'</code>，我们的插件就出问题了</p> <p><img src="https://oscimg.oschina.net/oscnet/3b6def74-c525-4f94-9ebb-deafb72b7e28.jpg" alt=""></p> <p>如果遇到这种写法，那么默认导入的他的<code>source</code>是不变的，我们要把原来的 <code>source</code> 拿出来</p> <p>所以还需要判断一下，每一个 <code>specifier</code> 是不是一个 <code>ImportDefaultSpecifier</code> 然后处理不同的 <code>source</code>，完整处理逻辑应该如下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">importPlugin</span><span class="token punctuation">(</span><span class="token parameter">opt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> libraryDir <span class="token punctuation">}</span> <span class="token operator">=</span> opt<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">ImportDeclaration</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
        <span class="token comment">// console.log(&quot;ImportDeclaration -&gt; node&quot;, node)</span>
        <span class="token comment">// 得到节点的详细说明，然后转换成多个的 import 声明</span>
        <span class="token keyword">const</span> specifiers <span class="token operator">=</span> node<span class="token punctuation">.</span>specifiers<span class="token punctuation">;</span>
        <span class="token comment">// 要处理这个我们做一些判断，首先判断不是默认导出我们才处理，要考虑 import vant, { Button, Icon } from 'vant' 写法</span>
        <span class="token comment">// 还要考虑 specifiers 的长度，如果长度不是 1 并且不是默认导出我们才需要转换</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token operator">!</span><span class="token punctuation">(</span>
            specifiers<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span>
            t<span class="token punctuation">.</span><span class="token function">isImportDefaultSpecifier</span><span class="token punctuation">(</span>specifiers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> result <span class="token operator">=</span> specifiers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">specifier</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> local <span class="token operator">=</span> specifier<span class="token punctuation">.</span>local<span class="token punctuation">,</span>
              source<span class="token punctuation">;</span>
            <span class="token comment">// 判断是否存在默认导出的情况</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">isImportDefaultSpecifier</span><span class="token punctuation">(</span>specifier<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              source <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              source <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>
                <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>libraryDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>specifier<span class="token punctuation">.</span>local<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">importDeclaration</span><span class="token punctuation">(</span>
              <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">importDefaultSpecifier</span><span class="token punctuation">(</span>local<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              source
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          path<span class="token punctuation">.</span><span class="token function">replaceWithMultiple</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div></li></ul> <h2 id="babylon"><a href="#babylon" class="header-anchor">#</a> babyLon</h2> <h4 id="babylon-与-babel-的关系"><a href="#babylon-与-babel-的关系" class="header-anchor">#</a> babyLon 与 babel 的关系</h4> <p><code>babel</code> 使用的引擎是 <code>babylon</code>，<code>Babylon</code> 并非 <code>babel</code> 团队自己开发的，而是 <code>fork</code> 的 <code>acorn</code> 项目，<code>acorn</code> 的项目本人在很早之前在兴趣部落 1.0 在构建中使用，为了是做一些代码的转换，是很不错的一款引擎，不过 <code>acorn</code> 引擎只提供基本的解析 <code>ast</code> 的能力，遍历还需要配套的 <code>acorn-travesal</code>, 替换节点需要使用 <code>acorn-</code>，而这些开发，在 <code>Babel</code> 的插件体系开发下，变得一体化了（摘自 AlloyTeam 团队的剖析 babel）</p> <h4 id="使用-babylon"><a href="#使用-babylon" class="header-anchor">#</a> 使用 babyLon</h4> <p>使用 babylon 编写一个数组 rest 转 Es5 语法的插件</p> <p>把 <code>const arr = [ ...arr1, ...arr2 ]</code> 转成 <code>var arr = [].concat(arr1, arr2)</code></p> <ul><li><p>分析语法树
<img src="https://oscimg.oschina.net/oscnet/03608f83-7e7d-4de8-bfe5-3265ade3edd8.jpg" alt="">
由图分析得：</p> <ul><li>两棵树都是变量声明的方式，不同的是他们声明的关键字不一样</li> <li>他们初始化变量值的时候是不一样的，一个数组表达式（ArrayExpression）另一个是调用表达式（CallExpression）</li> <li>那就很简单了，把数组表达式转换为调用表达式就可以</li></ul></li> <li><p>分析类型
这段代码的核心生成一个 callExpression 调用表达式，所以对应官网上的类型，我们分析需要用到的 api</p> <ul><li><p>先来分析 init 里面，首先是 callExpression</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * @param {Expression} callee  (required)
 * @param {Array&lt;Expression | SpreadElement | JSXNamespacedName&gt;} source (required)
 */</span>
t<span class="token punctuation">.</span><span class="token function">callExpression</span><span class="token punctuation">(</span>callee<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>对应语法树上 callee 是一个 MemberExpression，所以要生成一个成员表达式</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * @param {Expression} object  (required)
 * @param {if computed then Expression else Identifier} property (required)
 * @param {boolean} computed (default: false)
 * @param {boolean} optional (default: null)
 */</span>
t<span class="token punctuation">.</span><span class="token function">memberExpression</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> property<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> optional<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>在 callee 的 object 是一个 ArrayExpression 数组表达式，是一个空数组</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * @param {Array&lt;null | Expression | SpreadElement&gt;} elements  (default: [])
 */</span>
t<span class="token punctuation">.</span><span class="token function">arrayExpression</span><span class="token punctuation">(</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>里面的东西分析完了，我们还要生成 VariableDeclarator 和 VariableDeclaration 最终生成新的语法树</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * @param {LVal} id  (required)
 * @param {Expression} init (default: null)
 */</span>
t<span class="token punctuation">.</span><span class="token function">variableDeclarator</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @param {&quot;var&quot; | &quot;let&quot; | &quot;const&quot;} kind  (required)
 * @param {Array&lt;VariableDeclarator&gt;} declarations (required)
 */</span>
t<span class="token punctuation">.</span><span class="token function">variableDeclaration</span><span class="token punctuation">(</span>kind<span class="token punctuation">,</span> declarations<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li></ul></li> <li><p>上代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> babylon <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;babylon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使用 babel 提供的包，traverse 和 generator 都是被暴露在 default 对象上的</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/traverse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/types&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">const arr = [ ...arr1, ...arr2 ]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// var arr = [].concat(arr1, arr2)</span>

<span class="token keyword">const</span> ast <span class="token operator">=</span> babylon<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 转换树</span>
<span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">VariableDeclaration</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
    <span class="token keyword">const</span> declarations <span class="token operator">=</span> node<span class="token punctuation">.</span>declarations<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;VariableDeclarator -&gt; declarations&quot;</span><span class="token punctuation">,</span> declarations<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> kind <span class="token operator">=</span> <span class="token string">&quot;var&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 边界判定</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      node<span class="token punctuation">.</span>kind <span class="token operator">!==</span> kind <span class="token operator">&amp;&amp;</span>
      declarations<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span>
      t<span class="token punctuation">.</span><span class="token function">isArrayExpression</span><span class="token punctuation">(</span>declarations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>init<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 取得之前的 elements</span>
      <span class="token keyword">const</span> args <span class="token operator">=</span> declarations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>init<span class="token punctuation">.</span>elements<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>argument<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> callee <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">memberExpression</span><span class="token punctuation">(</span>
        t<span class="token punctuation">.</span><span class="token function">arrayExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&quot;concat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token boolean">false</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> init <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">callExpression</span><span class="token punctuation">(</span>callee<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> declaration <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">variableDeclarator</span><span class="token punctuation">(</span>declarations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> variableDeclaration <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">variableDeclaration</span><span class="token punctuation">(</span>kind<span class="token punctuation">,</span> <span class="token punctuation">[</span>declaration<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>variableDeclaration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div></li></ul> <h2 id="具体语法树"><a href="#具体语法树" class="header-anchor">#</a> 具体语法树</h2> <p>和抽象语法树相对的是具体语法树（<code>Concrete Syntax Tree</code>）简称 CST（通常称作分析树）。一般的，在源代码的翻译和编译过程中，语法分析器创建出分析树。一旦 AST 被创建出来，在后续的处理过程中，比如语义分析阶段，会添加一些信息。</p> <p>关于 node 类型，全集大致如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>(parameter) node: Identifier | SimpleLiteral | RegExpLiteral | Program | FunctionDeclaration | FunctionExpression | ArrowFunctionExpression | SwitchCase | CatchClause | VariableDeclarator | ExpressionStatement | BlockStatement | EmptyStatement | DebuggerStatement | WithStatement | ReturnStatement | LabeledStatement | BreakStatement | ContinueStatement | IfStatement | SwitchStatement | ThrowStatement | TryStatement | WhileStatement | DoWhileStatement | ForStatement | ForInStatement | ForOfStatement | VariableDeclaration | ClassDeclaration | ThisExpression | ArrayExpression | ObjectExpression | YieldExpression | UnaryExpression | UpdateExpression | BinaryExpression | AssignmentExpression | LogicalExpression | MemberExpression | ConditionalExpression | SimpleCallExpression | NewExpression | SequenceExpression | TemplateLiteral | TaggedTemplateExpression | ClassExpression | MetaProperty | AwaitExpression | Property | AssignmentProperty | Super | TemplateElement | SpreadElement | ObjectPattern | ArrayPattern | RestElement | AssignmentPattern | ClassBody | MethodDefinition | ImportDeclaration | ExportNamedDeclaration | ExportDefaultDeclaration | ExportAllDeclaration | ImportSpecifier | ImportDefaultSpecifier | ImportNamespaceSpecifier | ExportSpecifier
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><a href="https://www.babeljs.cn/docs/" target="_blank" rel="noopener noreferrer">Babel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 有文档对 AST 树的详细定义,详细可以参考</p></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=%E5%89%8D%E7%AB%AF" title="标签">#前端</a><a href="/tags/?tag=%E5%B7%A5%E7%A8%8B%E5%8C%96" title="标签">#工程化</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/12/14, 23:27:23</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/9e9290/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">webpack工作流程</div></a> <a href="/pages/bd96c8/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">uglify-js代码是如何被压缩的</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/9e9290/" class="prev">webpack工作流程</a></span> <span class="next"><a href="/pages/bd96c8/">uglify-js代码是如何被压缩的</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/397a64/"><div>
            Hooks
            <!----></div></a> <span class="date">09-28</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/c8816b/"><div>
            状态更新
            <!----></div></a> <span class="date">09-26</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/4f6eee/"><div>
            Diff算法
            <!----></div></a> <span class="date">09-21</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:chstz_365@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/chst365" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>chst365 | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.cd205809.js" defer></script><script src="/assets/js/2.f4247a0b.js" defer></script><script src="/assets/js/44.221c0a08.js" defer></script>
  </body>
</html>
